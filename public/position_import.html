<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¥æ¥½æ›²ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; background: #f5f5f5; }
        .position-card { background: white; margin: 20px 0; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .position-header { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 10px 15px; border-radius: 5px; margin-bottom: 15px; }
        textarea { width: 100%; height: 120px; font-family: monospace; border: 2px solid #ddd; border-radius: 5px; padding: 10px; }
        .btn { background: #28a745; color: white; padding: 8px 15px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        .btn:hover { background: #218838; }
        .btn-clear { background: #dc3545; }
        .btn-clear:hover { background: #c82333; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .import-all { text-align: center; margin: 30px 0; }
        .btn-large { background: #007bff; font-size: 18px; padding: 15px 30px; }
        .position-tabs { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab { padding: 8px 15px; background: #e9ecef; border: none; border-radius: 20px; cursor: pointer; }
        .tab.active { background: #667eea; color: white; }
    </style>
</head>
<body>
    <h1>ğŸµ ãƒã‚¸ã‚·ãƒ§ãƒ³åˆ¥æ¥½æ›²ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</h1>
    
    <div class="position-tabs">
        <button class="tab active" onclick="showAll()">å…¨ã¦è¡¨ç¤º</button>
        <button class="tab" onclick="showPosition('å…ˆé‹’')">å…ˆé‹’</button>
        <button class="tab" onclick="showPosition('æ¬¡é‹’')">æ¬¡é‹’</button>
        <button class="tab" onclick="showPosition('ä¸­å …')">ä¸­å …</button>
        <button class="tab" onclick="showPosition('å‰¯å°†')">å‰¯å°†</button>
        <button class="tab" onclick="showPosition('å¤§å°†')">å¤§å°†</button>
    </div>

    <!-- å…ˆé‹’ -->
    <div class="position-card" data-position="å…ˆé‹’">
        <div class="position-header">
            <h2>å…ˆé‹’ï¼ˆLV10ï¼‰</h2>
        </div>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>é€šå¸¸æ›²</h4>
                <textarea id="data-å…ˆé‹’" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦&#10;1ã€€5.1.1.ã€€ANOTHER&#10;2ã€€Macho Gangã€€ANOTHER"></textarea>
                <button class="btn" onclick="importPosition('å…ˆé‹’', false)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å…ˆé‹’')">ã‚¯ãƒªã‚¢</button>
            </div>
            <div style="flex: 1;">
                <h4>å¿ƒç†æˆ¦</h4>
                <textarea id="data-å…ˆé‹’å¿ƒç†æˆ¦" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦&#10;1ã€€å¿ƒç†æˆ¦æ›²1ã€€ANOTHER&#10;2ã€€å¿ƒç†æˆ¦æ›²2ã€€HYPER"></textarea>
                <button class="btn" onclick="importPosition('å…ˆé‹’', true)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å…ˆé‹’å¿ƒç†æˆ¦')">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div id="result-å…ˆé‹’"></div>
    </div>

    <!-- æ¬¡é‹’ -->
    <div class="position-card" data-position="æ¬¡é‹’">
        <div class="position-header">
            <h2>æ¬¡é‹’ï¼ˆLV11 Lè­œé¢é™¤ãï¼‰</h2>
        </div>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>é€šå¸¸æ›²</h4>
                <textarea id="data-æ¬¡é‹’" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('æ¬¡é‹’', false)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('æ¬¡é‹’')">ã‚¯ãƒªã‚¢</button>
            </div>
            <div style="flex: 1;">
                <h4>å¿ƒç†æˆ¦</h4>
                <textarea id="data-æ¬¡é‹’å¿ƒç†æˆ¦" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('æ¬¡é‹’', true)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('æ¬¡é‹’å¿ƒç†æˆ¦')">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div id="result-æ¬¡é‹’"></div>
    </div>

    <!-- ä¸­å … -->
    <div class="position-card" data-position="ä¸­å …">
        <div class="position-header">
            <h2>ä¸­å …ï¼ˆLV11å…¨ã¦ï¼‰</h2>
        </div>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>é€šå¸¸æ›²</h4>
                <textarea id="data-ä¸­å …" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('ä¸­å …', false)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('ä¸­å …')">ã‚¯ãƒªã‚¢</button>
            </div>
            <div style="flex: 1;">
                <h4>å¿ƒç†æˆ¦</h4>
                <textarea id="data-ä¸­å …å¿ƒç†æˆ¦" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('ä¸­å …', true)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('ä¸­å …å¿ƒç†æˆ¦')">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div id="result-ä¸­å …"></div>
    </div>

    <!-- å‰¯å°† -->
    <div class="position-card" data-position="å‰¯å°†">
        <div class="position-header">
            <h2>å‰¯å°†</h2>
        </div>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>é€šå¸¸æ›²</h4>
                <textarea id="data-å‰¯å°†" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('å‰¯å°†', false)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å‰¯å°†')">ã‚¯ãƒªã‚¢</button>
            </div>
            <div style="flex: 1;">
                <h4>å¿ƒç†æˆ¦</h4>
                <textarea id="data-å‰¯å°†å¿ƒç†æˆ¦" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('å‰¯å°†', true)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å‰¯å°†å¿ƒç†æˆ¦')">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div id="result-å‰¯å°†"></div>
    </div>

    <!-- å¤§å°† -->
    <div class="position-card" data-position="å¤§å°†">
        <div class="position-header">
            <h2>å¤§å°†</h2>
        </div>
        <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
                <h4>é€šå¸¸æ›²</h4>
                <textarea id="data-å¤§å°†" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('å¤§å°†', false)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å¤§å°†')">ã‚¯ãƒªã‚¢</button>
            </div>
            <div style="flex: 1;">
                <h4>å¿ƒç†æˆ¦</h4>
                <textarea id="data-å¤§å°†å¿ƒç†æˆ¦" placeholder="ç•ªå·ã€€æ›²åã€€é›£æ˜“åº¦"></textarea>
                <button class="btn" onclick="importPosition('å¤§å°†', true)">ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
                <button class="btn btn-clear" onclick="clearData('å¤§å°†å¿ƒç†æˆ¦')">ã‚¯ãƒªã‚¢</button>
            </div>
        </div>
        <div id="result-å¤§å°†"></div>
    </div>

    <div class="import-all">
        <button class="btn btn-large" onclick="importAllPositions()">ğŸš€ å…¨ãƒã‚¸ã‚·ãƒ§ãƒ³ä¸€æ‹¬ã‚¤ãƒ³ãƒãƒ¼ãƒˆ</button>
        <p>å„ãƒã‚¸ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™</p>
    </div>

    <script>
        function showAll() {
            document.querySelectorAll('.position-card').forEach(card => card.style.display = 'block');
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        function showPosition(position) {
            document.querySelectorAll('.position-card').forEach(card => {
                card.style.display = card.dataset.position === position ? 'block' : 'none';
            });
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
        }

        function clearData(position) {
            document.getElementById('data-' + position).value = '';
        }

        async function importPosition(position, isShinrisen) {
            const textareaId = isShinrisen ? `data-${position}å¿ƒç†æˆ¦` : `data-${position}`;
            const data = document.getElementById(textareaId).value.trim();
            
            if (!data) {
                alert('ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‘ãƒ¼ã‚¹
            const lines = data.split('\n');
            const songs = [];
            
            lines.forEach(line => {
                if (line.trim()) {
                    const parts = line.trim().split('\t');
                    if (parts.length >= 3) {
                        songs.push({
                            number: parseInt(parts[0]) || 0,
                            title: parts[1] || '',
                            difficulty: parts[2] || '',
                            position: position,
                            is_shinrisen: isShinrisen
                        });
                    }
                }
            });

            if (songs.length === 0) {
                alert('æœ‰åŠ¹ãªãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            try {
                const response = await fetch('./api/import_position_songs.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ songs: songs })
                });

                const responseText = await response.text();
                console.log('API Response:', responseText); // ãƒ‡ãƒãƒƒã‚°ç”¨
                
                let result;
                try {
                    result = JSON.parse(responseText);
                } catch (jsonError) {
                    throw new Error('JSONãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼: ' + responseText.substring(0, 200));
                }

                const resultDiv = document.getElementById('result-' + position);
                resultDiv.innerHTML = `<div class="${result.success ? 'result success' : 'result error'}">
                    ${result.message}
                </div>`;
                
            } catch (error) {
                const resultDiv = document.getElementById('result-' + position);
                resultDiv.innerHTML = `<div class="result error">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
            }
        }

        async function importAllPositions() {
            const positions = ['å…ˆé‹’', 'æ¬¡é‹’', 'ä¸­å …', 'å‰¯å°†', 'å¤§å°†'];
            let totalImported = 0;
            
            for (const position of positions) {
                // é€šå¸¸æ›²
                const normalData = document.getElementById(`data-${position}`).value.trim();
                if (normalData) {
                    await importPosition(position, false);
                    totalImported++;
                }
                
                // å¿ƒç†æˆ¦
                const shinrisenData = document.getElementById(`data-${position}å¿ƒç†æˆ¦`).value.trim();
                if (shinrisenData) {
                    await importPosition(position, true);
                    totalImported++;
                }
            }
            
            alert(`${totalImported}ã‚«ãƒ†ã‚´ãƒªã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ`);
        }
    </script>
</body>
</html>